<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEGIS 3.0 | Smart Insulin Assistant</title>
    <meta name="description" content="AI-powered insulin dosing assistant for Type 1 Diabetes">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <!-- Simple Top Navigation -->
        <header class="top-header">
            <div class="brand">
                <span class="brand-logo">‚¨°</span>
                <span class="brand-name">AEGIS</span>
                <span class="brand-tag">Smart Insulin Assistant</span>
            </div>
            <nav class="top-nav">
                <button class="nav-btn active" data-section="input">1. Enter Data</button>
                <button class="nav-btn" data-section="results">2. View Results</button>
                <button class="nav-btn" data-section="demo">3. Run Demo</button>
            </nav>
            <button class="emergency-btn" id="emergency-stop">üö® Emergency Stop</button>
        </header>

        <main class="main-content">
            <!-- Step 1: Input Section -->
            <section id="input-section" class="section active">
                <div class="section-header">
                    <h1>Tell us about your meal</h1>
                    <p>Enter your current glucose and what you're about to eat. AEGIS will calculate the best insulin
                        dose for you.</p>
                </div>

                <div class="input-cards">
                    <!-- Current Glucose -->
                    <div class="input-card glucose-card">
                        <h2>Your Current Glucose</h2>
                        <div class="glucose-display">
                            <input type="number" id="current-glucose" value="120" min="40" max="400"
                                class="glucose-input">
                            <span class="glucose-unit">mg/dL</span>
                        </div>
                        <div class="glucose-status" id="glucose-status">
                            <span class="status-dot good"></span>
                            <span class="status-text">In target range</span>
                        </div>
                        <div class="glucose-trend">
                            <label>Trend:</label>
                            <select id="glucose-trend" class="simple-select">
                                <option value="stable">‚Üí Stable</option>
                                <option value="rising_slow">‚Üó Rising slowly</option>
                                <option value="rising_fast">‚Üë Rising fast</option>
                                <option value="falling_slow">‚Üò Falling slowly</option>
                                <option value="falling_fast">‚Üì Falling fast</option>
                            </select>
                        </div>
                    </div>

                    <!-- Meal Info -->
                    <div class="input-card meal-card">
                        <h2>Your Meal</h2>
                        <div class="meal-type-selector">
                            <button class="meal-type-btn active" data-type="breakfast">üåÖ Breakfast</button>
                            <button class="meal-type-btn" data-type="lunch">‚òÄÔ∏è Lunch</button>
                            <button class="meal-type-btn" data-type="dinner">üåô Dinner</button>
                            <button class="meal-type-btn" data-type="snack">üçé Snack</button>
                        </div>
                        <input type="hidden" id="meal-type" value="breakfast">

                        <div class="carb-input">
                            <label>Carbohydrates in your meal:</label>
                            <div class="carb-slider-container">
                                <input type="range" id="meal-carbs" min="0" max="150" value="45" class="carb-slider">
                                <div class="carb-value">
                                    <span id="carb-display">45</span>
                                    <span>grams</span>
                                </div>
                            </div>
                            <div class="carb-presets">
                                <button class="preset-btn" data-carbs="15">Light (15g)</button>
                                <button class="preset-btn" data-carbs="45">Medium (45g)</button>
                                <button class="preset-btn" data-carbs="75">Large (75g)</button>
                            </div>
                        </div>
                    </div>

                    <!-- How You're Feeling -->
                    <div class="input-card feeling-card">
                        <h2>How are you feeling?</h2>
                        <p class="card-hint">This helps us adjust for factors that affect insulin sensitivity</p>

                        <div class="feeling-options">
                            <div class="feeling-group">
                                <label>Activity level today:</label>
                                <div class="option-buttons">
                                    <button class="option-btn" data-field="activity" data-value="sedentary">ü™ë
                                        Sedentary</button>
                                    <button class="option-btn active" data-field="activity" data-value="light">üö∂
                                        Light</button>
                                    <button class="option-btn" data-field="activity" data-value="moderate">üèÉ
                                        Active</button>
                                    <button class="option-btn" data-field="activity" data-value="intense">üí™
                                        Intense</button>
                                </div>
                            </div>

                            <div class="feeling-group">
                                <label>Stress level:</label>
                                <div class="option-buttons">
                                    <button class="option-btn" data-field="stress" data-value="low">üòå Relaxed</button>
                                    <button class="option-btn active" data-field="stress" data-value="normal">üòä
                                        Normal</button>
                                    <button class="option-btn" data-field="stress" data-value="elevated">üò∞
                                        Stressed</button>
                                    <button class="option-btn" data-field="stress" data-value="high">üò´ Very
                                        stressed</button>
                                </div>
                            </div>

                            <div class="feeling-group">
                                <label>Sleep last night:</label>
                                <div class="option-buttons">
                                    <button class="option-btn" data-field="sleep" data-value="poor">üò¥ Poor</button>
                                    <button class="option-btn" data-field="sleep" data-value="fair">üôÇ Fair</button>
                                    <button class="option-btn active" data-field="sleep" data-value="good">üòä
                                        Good</button>
                                    <button class="option-btn" data-field="sleep" data-value="excellent">ü§©
                                        Great</button>
                                </div>
                            </div>

                            <div class="feeling-group">
                                <label>Feeling unwell?</label>
                                <div class="option-buttons">
                                    <button class="option-btn active" data-field="illness" data-value="none">‚úÖ
                                        No</button>
                                    <button class="option-btn" data-field="illness" data-value="mild_cold">ü§ß Mild
                                        cold</button>
                                    <button class="option-btn" data-field="illness" data-value="fever">ü§í Fever</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Your Settings -->
                    <div class="input-card settings-card">
                        <h2>Your Insulin Settings</h2>
                        <p class="card-hint">These should match your pump or doctor's instructions</p>

                        <div class="settings-grid">
                            <div class="setting-item">
                                <label>Total Daily Insulin (TDI)</label>
                                <div class="setting-input">
                                    <input type="number" id="patient-tdi" value="45" min="5" max="150">
                                    <span>units/day</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label>Body Weight</label>
                                <div class="setting-input">
                                    <input type="number" id="patient-weight" value="75" min="20" max="200">
                                    <span>kg</span>
                                </div>
                            </div>
                        </div>

                        <div class="calculated-settings">
                            <div class="calc-item">
                                <span class="calc-label">Your Carb Ratio:</span>
                                <span class="calc-value" id="calc-icr">1:11</span>
                                <span class="calc-explain">(1 unit per 11g carbs)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">Your Correction Factor:</span>
                                <span class="calc-value" id="calc-isf">40</span>
                                <span class="calc-explain">(1 unit lowers glucose by 40 mg/dL)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-section">
                    <button class="primary-action" id="calculate-dose">
                        Calculate My Insulin Dose
                    </button>
                </div>
            </section>

            <!-- Step 2: Results Section -->
            <section id="results-section" class="section">
                <!-- Empty State -->
                <div class="empty-state" id="results-empty">
                    <div class="empty-icon">üìä</div>
                    <h2>No Results Yet</h2>
                    <p>Enter your glucose and meal information first, then click "Calculate My Insulin Dose"</p>
                    <button class="secondary-btn" onclick="navigateToSection('input')">Go to Input</button>
                </div>

                <!-- Results Content -->
                <div class="results-content hidden" id="results-content">
                    <!-- Main Recommendation -->
                    <div class="recommendation-hero">
                        <div class="rec-header">
                            <h1>Your Recommended Dose</h1>
                            <div class="safety-badge" id="safety-badge">
                                <span class="badge-icon">‚úì</span>
                                <span class="badge-text">Safety Verified</span>
                            </div>
                        </div>

                        <div class="dose-display">
                            <div class="dose-main">
                                <span class="dose-number" id="final-dose">4.5</span>
                                <span class="dose-unit">units</span>
                            </div>
                            <p class="dose-explanation" id="dose-explanation">
                                Based on your 45g carb meal and current glucose of 120 mg/dL
                            </p>
                        </div>

                        <div class="dose-breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">For your meal</span>
                                <span class="breakdown-value" id="meal-dose">4.0 U</span>
                            </div>
                            <div class="breakdown-plus">+</div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Correction</span>
                                <span class="breakdown-value" id="correction-dose">0.5 U</span>
                            </div>
                            <div class="breakdown-item adjustment" id="adjustment-item">
                                <span class="breakdown-label">Adjustment</span>
                                <span class="breakdown-value" id="adjustment-dose">0.0 U</span>
                            </div>
                        </div>
                    </div>

                    <!-- What This Means -->
                    <div class="explanation-card">
                        <h2>üìã What This Means</h2>
                        <div class="explanation-content">
                            <div class="explanation-item" id="explain-meal">
                                <strong>Meal Coverage:</strong> You're eating 45g of carbs. With your carb ratio of
                                1:11, you need about 4.0 units to cover this meal.
                            </div>
                            <div class="explanation-item" id="explain-correction">
                                <strong>Correction:</strong> Your glucose is 120 mg/dL, which is in range. A small
                                correction of 0.5 units will help reach your target of 110 mg/dL.
                            </div>
                            <div class="explanation-item" id="explain-factors">
                                <strong>Other Factors:</strong> We detected no special factors affecting your insulin
                                needs today.
                            </div>
                        </div>
                    </div>

                    <!-- Prediction -->
                    <div class="prediction-card">
                        <h2>üìà What to Expect</h2>
                        <div class="prediction-content">
                            <div class="prediction-chart">
                                <canvas id="prediction-chart"></canvas>
                            </div>
                            <div class="prediction-summary">
                                <div class="pred-item">
                                    <span class="pred-label">Expected peak glucose</span>
                                    <span class="pred-value" id="pred-peak">165 mg/dL</span>
                                    <span class="pred-time" id="pred-peak-time">in about 1 hour</span>
                                </div>
                                <div class="pred-item">
                                    <span class="pred-label">Return to normal</span>
                                    <span class="pred-value" id="pred-return">~3 hours</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Safety Check -->
                    <div class="safety-card">
                        <h2>üõ°Ô∏è Safety Check</h2>
                        <div class="safety-content">
                            <div class="safety-item pass" id="safety-1">
                                <span class="safety-icon">‚úì</span>
                                <span class="safety-text">Glucose is safe for insulin delivery</span>
                            </div>
                            <div class="safety-item pass" id="safety-2">
                                <span class="safety-icon">‚úì</span>
                                <span class="safety-text">No predicted low blood sugar</span>
                            </div>
                            <div class="safety-item pass" id="safety-3">
                                <span class="safety-icon">‚úì</span>
                                <span class="safety-text">Dose within safe limits</span>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="result-actions">
                        <button class="action-approve" id="approve-btn">
                            ‚úì Use This Dose
                        </button>
                        <button class="action-adjust" id="adjust-btn">
                            Adjust Dose
                        </button>
                        <button class="action-recalc" onclick="navigateToSection('input')">
                            ‚Üê Change My Input
                        </button>
                    </div>
                </div>
            </section>

            <!-- Step 3: Demo Section -->
            <section id="demo-section" class="section">
                <div class="section-header">
                    <h1>Run a Demo Simulation</h1>
                    <p>See how AEGIS handles a full day of insulin management with different scenarios.</p>
                </div>

                <div class="demo-setup">
                    <div class="demo-options">
                        <div class="demo-option">
                            <label>Scenario:</label>
                            <select id="demo-scenario" class="simple-select">
                                <option value="normal">Normal Day - 3 meals</option>
                                <option value="exercise">Day with Exercise</option>
                                <option value="stress">Stressful Day</option>
                                <option value="high_carb">High Carb Challenge</option>
                            </select>
                        </div>
                        <div class="demo-option">
                            <label>Duration:</label>
                            <select id="demo-duration" class="simple-select">
                                <option value="12">12 Hours</option>
                                <option value="24" selected>24 Hours</option>
                            </select>
                        </div>
                    </div>
                    <button class="primary-action" id="run-demo">Run Demo Simulation</button>
                </div>

                <div class="demo-results hidden" id="demo-results">
                    <div class="demo-chart-container">
                        <canvas id="demo-chart"></canvas>
                    </div>

                    <div class="demo-summary">
                        <h3>Simulation Results</h3>
                        <div class="demo-metrics">
                            <div class="demo-metric good">
                                <span class="metric-value" id="demo-tir">--</span>
                                <span class="metric-label">Time in Range</span>
                                <span class="metric-explain">Goal: >70%</span>
                            </div>
                            <div class="demo-metric" id="demo-low-metric">
                                <span class="metric-value" id="demo-low">--</span>
                                <span class="metric-label">Time Low</span>
                                <span class="metric-explain">Goal: <4%< /span>
                            </div>
                            <div class="demo-metric">
                                <span class="metric-value" id="demo-high">--</span>
                                <span class="metric-label">Time High</span>
                                <span class="metric-explain">Goal: <25%< /span>
                            </div>
                            <div class="demo-metric">
                                <span class="metric-value" id="demo-avg">--</span>
                                <span class="metric-label">Average Glucose</span>
                                <span class="metric-explain">Goal: 100-140</span>
                            </div>
                        </div>

                        <div class="demo-interpretation" id="demo-interpretation">
                            Run the simulation to see results.
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="aegis-engine.js"></script>
    <script src="app.js"></script>
</body>

</html>